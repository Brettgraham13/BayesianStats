"0","update = function(A,o,games_ratios) {"
"0","  (t(A) %*% (1/(games_ratios*(A %*% (1/o)))))* games_ratios "
"0","}"
"0","run_alg = function(A,o,games_ratios,epsilon = 0.5*10^-4) {"
"0","  diff = Inf"
"0","  while(diff > epsilon) {"
"0","    new_o = update(A,o,games_ratios)"
"0","    diff = sqrt(t(new_o - o) %*% (new_o - o))"
"0","    o = new_o"
"0","  }"
"0","  return(o)"
"0","}"
"0","get_games_ratios = function(g) {"
"0","  max(degree(g))/degree(g)"
"0","}"
"0","get_defense = function(A,o,games_ratios) {"
"0","  (A %*% (1/o)) * games_ratios"
"0","}"
"0","calculateOD <- function(g, e = .5*10^-5){"
"0","  #initialize offense vectors to have every team with an offensive score of 1"
"0","  offense = rep(1,length(V(g)))"
"0","  "
"0","  Adj = as.matrix(get.adjacency(g,attr='weight'))"
"0","  Adj = Adj + e*(offense %*% t(offense) - diag(length(V(g))))"
"0","  Adj = t(Adj)"
"0","  games_ratios = get_games_ratios(g)"
"0","  "
"0","  final_offense = run_alg(Adj, offense,games_ratios,epsilon = e)"
"0","  final_defense = get_defense(Adj,final_offense,games_ratios)"
"0","  "
"0","  # offenseVect = final_offense - mean(final_offense)"
"0","  offenseVect =final_offense / sum(final_offense)"
"0","  offenseVect = offenseVect - mean(offenseVect)"
"0","  # offenseVect = offenseVect[order(offenseVect,decreasing = TRUE),,drop=FALSE]"
"0","  "
"0","  defenseVect = 1/(final_defense) "
"0","  defenseVect = defenseVect/sum(defenseVect)"
"0","  defenseVect = defenseVect - mean(defenseVect)"
"0","  # defenseVect = defenseVect[order(defenseVect,decreasing = TRUE),,drop=FALSE]"
"0","  "
"0","  return(list(offense = offenseVect, defense = defenseVect))"
"0","}"
"0","createODDF <- function(rawData){"
"0","  data <- simplify(rawData)"
"0","  teamData <- data.frame()"
"0","  "
"0","  #calculate OD "
"0","  columns = c(5,7,8,10)"
"0","  for(i in 2:max(data$Week)){"
"0","  #Create DF based on OD for points"
"0","    OD <- calculateOD(dataToGraph(data,i,4))"
"0","    offense <-OD$offense"
"0","    defense <- OD$defense"
"0","    "
"0","    week = rep(i,length(offense))"
"0","    teams <- names(offense[,1])"
"0","    "
"0","    weeklyDF <- data.frame(week,teams,offense,defense)"
"0","    for(j in columns){"
"0","    #Expand this DF to include OD for other stats"
"0","      OD <- calculateOD(dataToGraph(data,i,j))"
"0","      offense <-OD$offense"
"0","      defense <- OD$defense"
"0","      "
"0","      week = rep(i,length(offense))"
"0","      teams <- names(offense[,1])"
"0","      w <- data.frame(week,teams,offense,defense)"
"0","      "
"0","      weeklyDF <- weeklyDF %>%"
"0","        left_join(w,by= c(""week""=""week"",""teams"" = ""teams""))"
"0","    }"
"0","    "
"0","    teamData <- teamData %>%"
"0","      bind_rows(weeklyDF)"
"0","  }"
"0","  "
"0","  colnames(teamData) <- c(""Week"",'Team',""O_Points"",""D_Points"",""O_Net Rush"",""D_Net Rush"",""O_Avg Rush"",""D_Avg Rush"",""O_Net Pass"",'D_Net Pass','O_Avg Pass','D_Avg Pass')"
"0","  "
"0","  return(teamData)"
"0","}"
"0","# OD_2016 <-createODDF(game_stats_2016)"
"0","# View(OD_2016)"
"0","OD_2017 <-calculateOD(dataToGraph(simplify(game_stats_2017),20,4))"
"2","extract_numeric() is deprecated: please use readr::parse_number() instead
"
"0","View(OD_2017)"
